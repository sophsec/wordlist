#!/usr/bin/env ruby
$LOAD_PATH.unshift(File.expand_path(File.join(File.dirname(__FILE__),'..','lib')))

require 'wordlist'
require 'benchmark'
require 'fileutils'

TEXT_DIR = File.expand_path(File.join(File.dirname(__FILE__),'text'))

text = File.join(TEXT_DIR,'shaks12.txt')
path = File.expand_path(File.join(File.dirname(__FILE__),'shakespeare_wordlist.txt'))
FileUtils.rm_f(path)

Benchmark.bm do |bm|
  bm.report('build') do
    Wordlist::Builder.build(path) do |wordlist|
      wordlist.parse_file(text)
    end
  end

  bm.report('each_unique') do
    list = Wordlist::FlatFile.new(path)
    list.each_unique { |word| word }
  end

  bm.report('each_mutation (1)') do
    list = Wordlist::FlatFile.new(path)
    list.mutate /o/i, '0'

    list.each_mutation { |word| word }
  end

  bm.report('each_mutation (2)') do
    list = Wordlist::FlatFile.new(path)
    list.mutate /o/i, '0'
    list.mutate /a/i, '@'

    list.each_mutation { |word| word }
  end

  bm.report('each_mutation (3)') do
    list = Wordlist::FlatFile.new(path)
    list.mutate /o/i, '0'
    list.mutate /a/i, '@'
    list.mutate /e/i, '3'

    list.each_mutation { |word| word }
  end
end

Benchmark.bm do |bm|
  mutator = Wordlist::Mutator.new(/o/i, '0')

  bm.report('Mutator#matches') do
    mutator.matches('lololololoLOLOLOLOLO')
  end

  bm.report('Mutator#each') do
    mutator.each('lololololoLOLOLOLOLO') { |word| }
  end
end
